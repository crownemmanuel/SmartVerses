---
import { Icon } from 'astro-icon/components';

const steps = [
  {
    id: 'configure',
    number: '01',
    title: 'Configure',
    subtitle: 'Set up your templates',
    description: 'Define output paths, file naming, and choose your processing type â€” Simple, Regex, JavaScript, or AI-powered.',
    icon: 'ph:gear-six-bold',
    color: 'blue',
    preview: {
      type: 'settings',
      items: ['Output Path', 'Template Name', 'Processing Mode', 'AI Provider']
    }
  },
  {
    id: 'connect',
    number: '02',
    title: 'Connect',
    subtitle: 'Link to ProPresenter',
    description: "Use ProPresenter's Linked Text feature to connect text boxes to the files ProAssist generates. One-time setup.",
    icon: 'ph:link-bold',
    color: 'violet',
    preview: {
      type: 'connection',
      from: 'ProAssist',
      to: 'ProPresenter'
    }
  },
  {
    id: 'create',
    number: '03',
    title: 'Create',
    subtitle: 'Import or generate content',
    description: 'Import text files, use Live Slides for real-time editing, or let AI generate and format your content automatically.',
    icon: 'ph:magic-wand-bold',
    color: 'amber',
    preview: {
      type: 'slides',
      count: 3
    }
  },
  {
    id: 'present',
    number: '04',
    title: 'Present',
    subtitle: 'Go live instantly',
    description: 'Click any slide to update ProPresenter instantly. Use Stage Assist timers, SmartVerses, and AI automation.',
    icon: 'ph:play-circle-bold',
    color: 'emerald',
    preview: {
      type: 'live'
    }
  }
];

const colorClasses: Record<string, { bg: string; text: string; border: string; shadow: string; light: string }> = {
  blue: { bg: 'bg-blue-500', text: 'text-blue-600', border: 'border-blue-200', shadow: 'shadow-blue-500/25', light: 'bg-blue-50' },
  violet: { bg: 'bg-violet-500', text: 'text-violet-600', border: 'border-violet-200', shadow: 'shadow-violet-500/25', light: 'bg-violet-50' },
  amber: { bg: 'bg-amber-500', text: 'text-amber-600', border: 'border-amber-200', shadow: 'shadow-amber-500/25', light: 'bg-amber-50' },
  emerald: { bg: 'bg-emerald-500', text: 'text-emerald-600', border: 'border-emerald-200', shadow: 'shadow-emerald-500/25', light: 'bg-emerald-50' }
};
---

<section id="how-it-works" class="py-20 md:py-32 overflow-hidden">
  <div class="mx-auto max-w-7xl px-6">
    <!-- Header -->
    <div class="text-center mb-16">
      <p class="text-sm font-semibold tracking-widest text-zinc-500 dark:text-zinc-400 uppercase mb-4">Simple setup</p>
      <h2 class="text-4xl md:text-5xl font-bold tracking-tight text-zinc-900 dark:text-white">
        Up and running in <span class="bg-gradient-to-r from-violet-600 to-fuchsia-600 bg-clip-text text-transparent">minutes</span>
      </h2>
    </div>

    <!-- Desktop: Horizontal Timeline -->
    <div class="hidden lg:block">
      <!-- Progress Line -->
      <div class="relative mb-8">
        <div class="absolute top-6 left-0 right-0 h-0.5 bg-zinc-200 dark:bg-white/10"></div>
        <div class="absolute top-6 left-0 h-0.5 bg-gradient-to-r from-blue-500 via-violet-500 via-amber-500 to-emerald-500 transition-all duration-500" id="progress-line" style="width: 0%"></div>

        <!-- Step Indicators -->
        <div class="relative flex justify-between">
          {steps.map((step, index) => (
            <button
              class="step-indicator group flex flex-col items-center cursor-pointer"
              data-step={step.id}
              data-index={index}
            >
              <div class={`size-12 rounded-full ${index === 0 ? colorClasses[step.color].bg + ' text-white' : 'bg-white dark:bg-white/10 border-2 border-zinc-200 dark:border-white/15'} flex items-center justify-center font-bold text-sm transition-all duration-300 group-hover:scale-110 shadow-lg ${index === 0 ? colorClasses[step.color].shadow : ''}`}>
                {step.number}
              </div>
              <span class={`mt-3 text-sm font-medium ${index === 0 ? colorClasses[step.color].text : 'text-zinc-400'} transition-colors`}>
                {step.title}
              </span>
            </button>
          ))}
        </div>
      </div>

      <!-- Content Panel -->
      <div class="relative mt-12 rounded-3xl border border-zinc-200 dark:border-white/10 bg-white dark:bg-white/[0.03] p-8 md:p-12 shadow-xl dark:shadow-black/20" id="step-content">
        {steps.map((step, index) => (
          <div
            class={`step-panel ${index === 0 ? 'active' : ''}`}
            data-panel={step.id}
            style={index === 0 ? '' : 'display: none;'}
          >
            <div class="grid md:grid-cols-2 gap-8 items-center">
              <!-- Text Content -->
              <div>
                <div class={`inline-flex items-center gap-2 px-3 py-1 rounded-full ${colorClasses[step.color].light} ${colorClasses[step.color].text} text-sm font-medium mb-4`}>
                  <Icon name={step.icon} class="size-4" />
                  Step {step.number}
                </div>
                <h3 class="text-3xl font-bold text-zinc-900 dark:text-white mb-2">{step.title}</h3>
                <p class="text-lg text-zinc-500 dark:text-zinc-400 mb-4">{step.subtitle}</p>
                <p class="text-zinc-600 dark:text-zinc-300 leading-relaxed">{step.description}</p>
              </div>

              <!-- Visual Preview -->
              <div class={`${colorClasses[step.color].light} rounded-2xl p-6 border ${colorClasses[step.color].border}`}>
                {step.preview.type === 'settings' && (
                  <div class="space-y-3">
                    {step.preview.items?.map((item, i) => (
                      <div class="flex items-center gap-3 bg-white dark:bg-white/10 rounded-lg p-3 shadow-sm" style={`animation-delay: ${i * 100}ms`}>
                        <div class={`size-2 rounded-full ${colorClasses[step.color].bg}`}></div>
                        <span class="text-sm text-zinc-700 dark:text-white">{item}</span>
                        <div class="ml-auto w-20 h-2 bg-zinc-100 rounded-full"></div>
                      </div>
                    ))}
                  </div>
                )}

                {step.preview.type === 'connection' && (
                  <div class="flex items-center justify-center gap-4 py-8">
                    <div class="bg-white dark:bg-white/10 rounded-xl p-4 shadow-md text-center">
                      <Icon name="ph:app-window-bold" class={`size-8 mx-auto mb-2 ${colorClasses[step.color].text}`} />
                      <span class="text-sm font-medium text-zinc-700">{step.preview.from}</span>
                    </div>
                    <div class="flex items-center gap-1">
                      <div class={`w-8 h-0.5 ${colorClasses[step.color].bg}`}></div>
                      <Icon name="ph:arrow-right-bold" class={`size-5 ${colorClasses[step.color].text}`} />
                      <div class={`w-8 h-0.5 ${colorClasses[step.color].bg}`}></div>
                    </div>
                    <div class="bg-white dark:bg-white/10 rounded-xl p-4 shadow-md text-center">
                      <Icon name="ph:presentation-chart-bold" class={`size-8 mx-auto mb-2 ${colorClasses[step.color].text}`} />
                      <span class="text-sm font-medium text-zinc-700">{step.preview.to}</span>
                    </div>
                  </div>
                )}

                {step.preview.type === 'slides' && (
                  <div class="space-y-3">
                    {[...Array(step.preview.count || 3)].map((_, i) => (
                      <div class="bg-white dark:bg-white/10 rounded-lg p-4 shadow-sm flex items-center gap-3" style={`animation-delay: ${i * 100}ms`}>
                        <div class={`size-8 rounded-lg ${colorClasses[step.color].bg} flex items-center justify-center text-white text-xs font-bold`}>
                          {i + 1}
                        </div>
                        <div class="flex-1">
                          <div class="h-2 bg-zinc-200 rounded-full w-3/4 mb-1"></div>
                          <div class="h-2 bg-zinc-100 rounded-full w-1/2"></div>
                        </div>
                      </div>
                    ))}
                  </div>
                )}

                {step.preview.type === 'live' && (
                  <div class="text-center py-6">
                    <div class="relative inline-flex">
                      <div class={`size-20 rounded-full ${colorClasses[step.color].bg} flex items-center justify-center shadow-lg ${colorClasses[step.color].shadow}`}>
                        <Icon name="ph:play-fill" class="size-10 text-white ml-1" />
                      </div>
                      <span class="absolute -top-1 -right-1 flex size-6">
                        <span class={`animate-ping absolute inline-flex h-full w-full rounded-full ${colorClasses[step.color].bg} opacity-75`}></span>
                        <span class={`relative inline-flex rounded-full size-6 ${colorClasses[step.color].bg} items-center justify-center`}>
                          <Icon name="ph:check-bold" class="size-3 text-white" />
                        </span>
                      </span>
                    </div>
                    <p class={`mt-4 font-semibold ${colorClasses[step.color].text}`}>Live on ProPresenter</p>
                    <p class="text-sm text-zinc-500 dark:text-zinc-400">Changes sync instantly</p>
                  </div>
                )}
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>

    <!-- Mobile: Vertical Cards -->
    <div class="lg:hidden space-y-6">
      {steps.map((step, index) => (
        <div class={`relative rounded-2xl border ${colorClasses[step.color].border} ${colorClasses[step.color].light} p-6`}>
          <!-- Connector Line -->
          {index < steps.length - 1 && (
            <div class="absolute left-8 top-full w-0.5 h-6 bg-gradient-to-b from-zinc-300 to-transparent"></div>
          )}

          <div class="flex gap-4">
            <div class={`size-12 shrink-0 rounded-xl ${colorClasses[step.color].bg} flex items-center justify-center shadow-lg ${colorClasses[step.color].shadow}`}>
              <Icon name={step.icon} class="size-6 text-white" />
            </div>
            <div>
              <div class="flex items-center gap-2 mb-1">
                <span class={`text-xs font-bold ${colorClasses[step.color].text}`}>{step.number}</span>
                <h3 class="font-bold text-zinc-900 dark:text-white">{step.title}</h3>
              </div>
              <p class="text-sm text-zinc-600">{step.description}</p>
            </div>
          </div>
        </div>
      ))}
    </div>

  </div>
</section>

<script>
  const indicators = document.querySelectorAll('.step-indicator');
  const panels = document.querySelectorAll('.step-panel');
  const progressLine = document.getElementById('progress-line');

  const colors: Record<string, { bg: string; text: string; shadow: string }> = {
    '0': { bg: 'bg-blue-500', text: 'text-blue-600', shadow: 'shadow-blue-500/25' },
    '1': { bg: 'bg-violet-500', text: 'text-violet-600', shadow: 'shadow-violet-500/25' },
    '2': { bg: 'bg-amber-500', text: 'text-amber-600', shadow: 'shadow-amber-500/25' },
    '3': { bg: 'bg-emerald-500', text: 'text-emerald-600', shadow: 'shadow-emerald-500/25' }
  };

  let currentStep = 0;

  function updateStep(index: number) {
    currentStep = index;

    // Update progress line
    const progress = (index / (indicators.length - 1)) * 100;
    if (progressLine) {
      progressLine.style.width = `${progress}%`;
    }

    // Update indicators
    indicators.forEach((ind, i) => {
      const circle = ind.querySelector('div');
      const label = ind.querySelector('span');

      if (circle && label) {
        if (i <= index) {
          circle.className = `size-12 rounded-full ${colors[i].bg} text-white flex items-center justify-center font-bold text-sm transition-all duration-300 group-hover:scale-110 shadow-lg ${colors[i].shadow}`;
          label.className = `mt-3 text-sm font-medium ${colors[i].text} transition-colors`;
        } else {
          const isDark = document.documentElement.classList.contains('dark');
          circle.className = `size-12 rounded-full ${isDark ? 'bg-white/10 border-white/15' : 'bg-white border-zinc-200'} border-2 flex items-center justify-center font-bold text-sm transition-all duration-300 group-hover:scale-110 shadow-lg text-zinc-400`;
          label.className = 'mt-3 text-sm font-medium text-zinc-400 transition-colors';
        }
      }
    });

    // Update panels
    panels.forEach((panel, i) => {
      const el = panel as HTMLElement;
      if (i === index) {
        el.style.display = 'block';
        el.style.opacity = '0';
        setTimeout(() => { el.style.opacity = '1'; }, 50);
      } else {
        el.style.display = 'none';
      }
    });
  }

  indicators.forEach((indicator) => {
    indicator.addEventListener('click', () => {
      const index = parseInt(indicator.getAttribute('data-index') || '0');
      updateStep(index);
    });
  });

  // Auto-advance every 5 seconds
  let autoAdvance = setInterval(() => {
    const next = (currentStep + 1) % indicators.length;
    updateStep(next);
  }, 5000);

  // Pause auto-advance on hover
  const contentPanel = document.getElementById('step-content');
  contentPanel?.addEventListener('mouseenter', () => clearInterval(autoAdvance));
  contentPanel?.addEventListener('mouseleave', () => {
    autoAdvance = setInterval(() => {
      const next = (currentStep + 1) % indicators.length;
      updateStep(next);
    }, 5000);
  });

  // Initialize
  updateStep(0);
</script>

<style>
  .step-panel {
    transition: opacity 0.3s ease;
  }
</style>
